{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/lib/superbaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabase = createClient(\r\n    process.env.SUPABASE_URL!,\r\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,WAAW,IAAA,mQAAY,EAChC,QAAQ,GAAG,CAAC,YAAY,EACxB,QAAQ,GAAG,CAAC,yBAAyB"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/app/api/upload/route.ts"],"sourcesContent":["// app/api/upload/route.ts\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport mongoose from \"mongoose\";\r\nimport crypto from \"crypto\";\r\n\r\nimport { supabase } from \"@/lib/superbaseClient\";\r\n\r\n// Connect to MongoDB helper\r\nasync function connectDB() {\r\n    if (!mongoose.connection.readyState) {\r\n        await mongoose.connect(process.env.MONGODB_URI!);\r\n    }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const formData = await req.formData();\r\n        const file = formData.get(\"file\") as File;\r\n        const userId = formData.get(\"userId\") as string;\r\n        const documentType = formData.get(\"documentType\") as string;\r\n\r\n        if (!file || !userId || !documentType) {\r\n            return NextResponse.json({ error: \"Missing parameters\" }, { status: 400 });\r\n        }\r\n\r\n        // Convert File to Buffer\r\n        const buffer = Buffer.from(await file.arrayBuffer());\r\n\r\n        // Generate unique filename\r\n        const filename = `${Date.now()}-${file.name}`;\r\n\r\n        // Upload to Supabase bucket \"documents\"\r\n        const { data, error: uploadError } = await supabase.storage\r\n            .from(\"documents\")\r\n            .upload(filename, buffer, { contentType: file.type });\r\n\r\n        if (uploadError) {\r\n            console.error(\"Supabase upload error:\", uploadError);\r\n            return NextResponse.json({ error: uploadError.message }, { status: 500 });\r\n        }\r\n\r\n        const fileUrl = `${process.env.SUPABASE_URL}/storage/v1/object/public/documents/${filename}`;\r\n\r\n        // Connect to MongoDB\r\n        await connectDB();\r\n\r\n        // Create new Document\r\n        const newDoc = await import(\"@/models/Document\").then(mod => mod.default.create({\r\n            userId,\r\n            type: documentType,\r\n            title: file.name, // Fallback title\r\n            url: fileUrl,\r\n            status: 'PENDING_VERIFICATION',\r\n            metadata: {\r\n                mimeType: file.type,\r\n                sizeBytes: buffer.length,\r\n                fileHash: crypto.createHash(\"sha256\").update(buffer).digest(\"hex\")\r\n            }\r\n        }));\r\n\r\n        // Blockchain hash (SHA256) - reusing what we calculated or just the one above\r\n        const blockchainHash = newDoc.metadata.fileHash;\r\n\r\n        return NextResponse.json({\r\n            message: \"Uploaded successfully\",\r\n            doc: newDoc,\r\n            blockchainHash,\r\n        });\r\n\r\n\r\n    } catch (err: any) {\r\n        console.error(\"Upload error:\", err);\r\n        return NextResponse.json({ error: err.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAAA,0BAA0B;;;;;AAC1B;AACA;AACA;AAEA;;;;;AAEA,4BAA4B;AAC5B,eAAe;IACX,IAAI,CAAC,oHAAQ,CAAC,UAAU,CAAC,UAAU,EAAE;QACjC,MAAM,oHAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,WAAW;IAClD;AACJ;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,SAAS,SAAS,GAAG,CAAC;QAC5B,MAAM,eAAe,SAAS,GAAG,CAAC;QAElC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,cAAc;YACnC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,yBAAyB;QACzB,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM,KAAK,WAAW;QAEjD,2BAA2B;QAC3B,MAAM,WAAW,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,IAAI,EAAE;QAE7C,wCAAwC;QACxC,MAAM,EAAE,IAAI,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,oIAAQ,CAAC,OAAO,CACtD,IAAI,CAAC,aACL,MAAM,CAAC,UAAU,QAAQ;YAAE,aAAa,KAAK,IAAI;QAAC;QAEvD,IAAI,aAAa;YACb,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,YAAY,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,UAAU,GAAG,QAAQ,GAAG,CAAC,YAAY,CAAC,oCAAoC,EAAE,UAAU;QAE5F,qBAAqB;QACrB,MAAM;QAEN,sBAAsB;QACtB,MAAM,SAAS,MAAM,+FAA4B,IAAI,CAAC,CAAA,MAAO,IAAI,OAAO,CAAC,MAAM,CAAC;gBAC5E;gBACA,MAAM;gBACN,OAAO,KAAK,IAAI;gBAChB,KAAK;gBACL,QAAQ;gBACR,UAAU;oBACN,UAAU,KAAK,IAAI;oBACnB,WAAW,OAAO,MAAM;oBACxB,UAAU,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,QAAQ,MAAM,CAAC;gBAChE;YACJ;QAEA,8EAA8E;QAC9E,MAAM,iBAAiB,OAAO,QAAQ,CAAC,QAAQ;QAE/C,OAAO,+QAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,KAAK;YACL;QACJ;IAGJ,EAAE,OAAO,KAAU;QACf,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACJ"}}]
}