{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/models/Vault.ts"],"sourcesContent":["// DEPRECATED: This model is kept for backward compatibility and as a potential user-settings container.\r\n// All documents are now Top-Level \"Document\" models.\r\n\r\nimport mongoose, { Schema, Document, model, models } from \"mongoose\";\r\n\r\nexport interface IVault extends Document {\r\n    userId: mongoose.Types.ObjectId;\r\n    // documents: IVaultDocument[]; // DEPRECATED - Removed in favor of generic Document model\r\n    encryptedMetadata?: string; // Placeholder for future vault-specific config\r\n}\r\n\r\nconst VaultSchema = new Schema<IVault>(\r\n    {\r\n        userId: { type: Schema.Types.ObjectId, ref: \"User\", required: true, index: true, unique: true },\r\n        encryptedMetadata: { type: String },\r\n    },\r\n    { timestamps: true }\r\n);\r\n\r\nexport default models.Vault || model<IVault>(\"Vault\", VaultSchema);\r\n"],"names":[],"mappings":"AAAA,wGAAwG;AACxG,qDAAqD;;;;;AAErD;;AAQA,MAAM,cAAc,IAAI,mHAAM,CAC1B;IACI,QAAQ;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;QAAM,OAAO;QAAM,QAAQ;IAAK;IAC9F,mBAAmB;QAAE,MAAM;IAAO;AACtC,GACA;IAAE,YAAY;AAAK;uCAGR,mHAAM,CAAC,KAAK,IAAI,IAAA,kHAAK,EAAS,SAAS"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/lib/superbaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\r\n\r\nexport const supabase = createClient(\r\n    process.env.SUPABASE_URL!,\r\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,WAAW,IAAA,mQAAY,EAChC,QAAQ,GAAG,CAAC,YAAY,EACxB,QAAQ,GAAG,CAAC,yBAAyB"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/app/api/upload/route.ts"],"sourcesContent":["// app/api/upload/route.ts\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport mongoose from \"mongoose\";\r\nimport crypto from \"crypto\";\r\nimport Vault from \"@/models/Vault\";\r\nimport {supabase} from \"@/lib/superbaseClient\";\r\n\r\n// Connect to MongoDB helper\r\nasync function connectDB() {\r\n    if (!mongoose.connection.readyState) {\r\n        await mongoose.connect(process.env.MONGODB_URI!);\r\n    }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const formData = await req.formData();\r\n        const file = formData.get(\"file\") as File;\r\n        const userId = formData.get(\"userId\") as string;\r\n        const documentType = formData.get(\"documentType\") as string;\r\n\r\n        if (!file || !userId || !documentType) {\r\n            return NextResponse.json({ error: \"Missing parameters\" }, { status: 400 });\r\n        }\r\n\r\n        // Convert File to Buffer\r\n        const buffer = Buffer.from(await file.arrayBuffer());\r\n\r\n        // Generate unique filename\r\n        const filename = `${Date.now()}-${file.name}`;\r\n\r\n        // Upload to Supabase bucket \"documents\"\r\n        const { data, error: uploadError } = await supabase.storage\r\n            .from(\"documents\")\r\n            .upload(filename, buffer, { contentType: file.type });\r\n\r\n        if (uploadError) {\r\n            console.error(\"Supabase upload error:\", uploadError);\r\n            return NextResponse.json({ error: uploadError.message }, { status: 500 });\r\n        }\r\n\r\n        const fileUrl = `${process.env.SUPABASE_URL}/storage/v1/object/public/documents/${filename}`;\r\n\r\n        // Connect to MongoDB\r\n        await connectDB();\r\n\r\n        // Update Vault\r\n        let vault = await Vault.findOne({ userId });\r\n        const docEntry = {\r\n            label: documentType,\r\n            url: fileUrl,\r\n            type: file.type,\r\n            uploadedAt: new Date(),\r\n        };\r\n\r\n        if (vault) {\r\n            vault.documents.push(docEntry);\r\n            await vault.save();\r\n        } else {\r\n            vault = await Vault.create({ userId, documents: [docEntry] });\r\n        }\r\n\r\n        // Blockchain hash (SHA256)\r\n        const blockchainHash = crypto.createHash(\"sha256\").update(buffer).digest(\"hex\");\r\n\r\n        return NextResponse.json({\r\n            message: \"Uploaded successfully\",\r\n            doc: docEntry,\r\n            blockchainHash,\r\n        });\r\n    } catch (err: any) {\r\n        console.error(\"Upload error:\", err);\r\n        return NextResponse.json({ error: err.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAAA,0BAA0B;;;;;AAC1B;AACA;AACA;AACA;AACA;;;;;;AAEA,4BAA4B;AAC5B,eAAe;IACX,IAAI,CAAC,oHAAQ,CAAC,UAAU,CAAC,UAAU,EAAE;QACjC,MAAM,oHAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,WAAW;IAClD;AACJ;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,MAAM,SAAS,SAAS,GAAG,CAAC;QAC5B,MAAM,eAAe,SAAS,GAAG,CAAC;QAElC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,cAAc;YACnC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,yBAAyB;QACzB,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM,KAAK,WAAW;QAEjD,2BAA2B;QAC3B,MAAM,WAAW,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,IAAI,EAAE;QAE7C,wCAAwC;QACxC,MAAM,EAAE,IAAI,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,oIAAQ,CAAC,OAAO,CACtD,IAAI,CAAC,aACL,MAAM,CAAC,UAAU,QAAQ;YAAE,aAAa,KAAK,IAAI;QAAC;QAEvD,IAAI,aAAa;YACb,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,YAAY,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,UAAU,GAAG,QAAQ,GAAG,CAAC,YAAY,CAAC,oCAAoC,EAAE,UAAU;QAE5F,qBAAqB;QACrB,MAAM;QAEN,eAAe;QACf,IAAI,QAAQ,MAAM,4HAAK,CAAC,OAAO,CAAC;YAAE;QAAO;QACzC,MAAM,WAAW;YACb,OAAO;YACP,KAAK;YACL,MAAM,KAAK,IAAI;YACf,YAAY,IAAI;QACpB;QAEA,IAAI,OAAO;YACP,MAAM,SAAS,CAAC,IAAI,CAAC;YACrB,MAAM,MAAM,IAAI;QACpB,OAAO;YACH,QAAQ,MAAM,4HAAK,CAAC,MAAM,CAAC;gBAAE;gBAAQ,WAAW;oBAAC;iBAAS;YAAC;QAC/D;QAEA,2BAA2B;QAC3B,MAAM,iBAAiB,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,QAAQ,MAAM,CAAC;QAEzE,OAAO,+QAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,KAAK;YACL;QACJ;IACJ,EAAE,OAAO,KAAU;QACf,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO,IAAI,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACnE;AACJ"}}]
}