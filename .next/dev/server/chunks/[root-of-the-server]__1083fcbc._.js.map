{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/lib/dbConnect.ts"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env.local');\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI!, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAEA;;;;CAIC,GACD,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAc,MAAM,IAAI,CAAC,CAAC;YAC1D,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/models/Document.ts"],"sourcesContent":["import mongoose, { Schema, Document, model, models } from \"mongoose\";\r\n\r\nexport interface IDocument extends Document {\r\n    userId: mongoose.Types.ObjectId; // Citizen Owner\r\n    type: string; // e.g., \"National ID\", \"Birth Certificate\"\r\n    title: string; // User-friendly name\r\n    url?: string; // File path or URL (Optional for requests)\r\n\r\n    // State Machine\r\n    status: \"PENDING_VERIFICATION\" | \"VERIFIED\" | \"ISSUED\" | \"REJECTED\" | \"EXPIRED\" | \"REQUESTED\";\r\n\r\n    // Metadata & AI\r\n    metadata: {\r\n        aiScore?: number;\r\n        aiFlags?: string[];\r\n        aiExplanation?: string;\r\n        extractedText?: string;\r\n        fileHash?: string;\r\n        mimeType?: string;\r\n        sizeBytes?: number;\r\n    };\r\n\r\n    // Government Audit Workflow\r\n    govAudit: {\r\n        uploadedBy?: mongoose.Types.ObjectId; // If Gov issued\r\n        verifiedBy?: mongoose.Types.ObjectId; // Gov User who verified\r\n        verifiedAt?: Date;\r\n        rejectedBy?: mongoose.Types.ObjectId;\r\n        rejectionReason?: string;\r\n        rejectedAt?: Date;\r\n        issuedAt?: Date;\r\n    };\r\n\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\nconst DocumentSchema = new Schema<IDocument>(\r\n    {\r\n        userId: { type: Schema.Types.ObjectId, ref: \"User\", required: true, index: true },\r\n        type: { type: String, required: true, index: true },\r\n        title: { type: String, required: true },\r\n        url: { type: String, required: false },\r\n\r\n        status: {\r\n            type: String,\r\n            enum: [\"PENDING_VERIFICATION\", \"VERIFIED\", \"ISSUED\", \"REJECTED\", \"EXPIRED\", \"REQUESTED\"],\r\n            default: \"PENDING_VERIFICATION\",\r\n            index: true,\r\n        },\r\n\r\n        metadata: {\r\n            aiScore: { type: Number },\r\n            aiFlags: [{ type: String }],\r\n            aiExplanation: { type: String },\r\n            extractedText: { type: String },\r\n            fileHash: { type: String },\r\n            mimeType: { type: String },\r\n            sizeBytes: { type: Number },\r\n        },\r\n\r\n        govAudit: {\r\n            uploadedBy: { type: Schema.Types.ObjectId, ref: \"User\" },\r\n            verifiedBy: { type: Schema.Types.ObjectId, ref: \"User\" },\r\n            verifiedAt: { type: Date },\r\n            rejectedBy: { type: Schema.Types.ObjectId, ref: \"User\" },\r\n            rejectionReason: { type: String },\r\n            rejectedAt: { type: Date },\r\n            issuedAt: { type: Date },\r\n        },\r\n    },\r\n    { timestamps: true }\r\n);\r\n\r\n// Indexes for common queries\r\nDocumentSchema.index({ \"govAudit.verifiedBy\": 1 });\r\nDocumentSchema.index({ createdAt: -1 });\r\n\r\nexport default models.Document || model<IDocument>(\"Document\", DocumentSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAqCA,MAAM,iBAAiB,IAAI,mHAAM,CAC7B;IACI,QAAQ;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;QAAM,OAAO;IAAK;IAChF,MAAM;QAAE,MAAM;QAAQ,UAAU;QAAM,OAAO;IAAK;IAClD,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,KAAK;QAAE,MAAM;QAAQ,UAAU;IAAM;IAErC,QAAQ;QACJ,MAAM;QACN,MAAM;YAAC;YAAwB;YAAY;YAAU;YAAY;YAAW;SAAY;QACxF,SAAS;QACT,OAAO;IACX;IAEA,UAAU;QACN,SAAS;YAAE,MAAM;QAAO;QACxB,SAAS;YAAC;gBAAE,MAAM;YAAO;SAAE;QAC3B,eAAe;YAAE,MAAM;QAAO;QAC9B,eAAe;YAAE,MAAM;QAAO;QAC9B,UAAU;YAAE,MAAM;QAAO;QACzB,UAAU;YAAE,MAAM;QAAO;QACzB,WAAW;YAAE,MAAM;QAAO;IAC9B;IAEA,UAAU;QACN,YAAY;YAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAAE,KAAK;QAAO;QACvD,YAAY;YAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAAE,KAAK;QAAO;QACvD,YAAY;YAAE,MAAM;QAAK;QACzB,YAAY;YAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;YAAE,KAAK;QAAO;QACvD,iBAAiB;YAAE,MAAM;QAAO;QAChC,YAAY;YAAE,MAAM;QAAK;QACzB,UAAU;YAAE,MAAM;QAAK;IAC3B;AACJ,GACA;IAAE,YAAY;AAAK;AAGvB,6BAA6B;AAC7B,eAAe,KAAK,CAAC;IAAE,uBAAuB;AAAE;AAChD,eAAe,KAAK,CAAC;IAAE,WAAW,CAAC;AAAE;uCAEtB,mHAAM,CAAC,QAAQ,IAAI,IAAA,kHAAK,EAAY,YAAY"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/models/AuditLog.ts"],"sourcesContent":["import mongoose, { Schema, Document, model, models } from \"mongoose\";\r\n\r\nexport interface IAuditLog extends Document {\r\n    actorId: mongoose.Types.ObjectId; // User who performed the action\r\n    action: \"DOCUMENT_UPLOAD\" | \"DOCUMENT_VERIFIED\" | \"DOCUMENT_REJECTED\" | \"DOCUMENT_ISSUED\" | \"ACCESS_GRANTED\" | \"LOGIN_FAILURE\" | \"GOV_User_ADDED\" | \"DOCUMENT_DELETED_REJECTED\" | \"DOCUMENT_REQUESTED\";\r\n    targetId?: mongoose.Types.ObjectId; // Document ID or User ID being acted upon\r\n    targetModel?: \"Document\" | \"User\";\r\n    details?: Record<string, any>; // Flexible metadata (reason, IP, etc.)\r\n    ipAddress?: string;\r\n    userAgent?: string;\r\n    timestamp: Date;\r\n}\r\n\r\nconst AuditLogSchema = new Schema<IAuditLog>(\r\n    {\r\n        actorId: { type: Schema.Types.ObjectId, ref: \"User\", required: true, index: true },\r\n        action: {\r\n            type: String,\r\n            enum: [\r\n                \"DOCUMENT_UPLOAD\",\r\n                \"DOCUMENT_VERIFIED\",\r\n                \"DOCUMENT_REJECTED\",\r\n                \"DOCUMENT_ISSUED\",\r\n                \"ACCESS_GRANTED\",\r\n                \"LOGIN_FAILURE\",\r\n                \"GOV_USER_ADDED\",\r\n                \"DOCUMENT_DELETED_REJECTED\",\r\n                \"DOCUMENT_REQUESTED\",\r\n            ],\r\n            required: true,\r\n            index: true,\r\n        },\r\n        targetId: { type: Schema.Types.ObjectId, index: true },\r\n        targetModel: { type: String, enum: [\"Document\", \"User\"] },\r\n        details: { type: Schema.Types.Mixed },\r\n        ipAddress: { type: String },\r\n        userAgent: { type: String },\r\n        timestamp: { type: Date, default: Date.now, index: true },\r\n    },\r\n    { timestamps: { createdAt: true, updatedAt: false } } // Immutable logs\r\n);\r\n\r\nexport default models.AuditLog || model<IAuditLog>(\"AuditLog\", AuditLogSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAaA,MAAM,iBAAiB,IAAI,mHAAM,CAC7B;IACI,SAAS;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;QAAM,OAAO;IAAK;IACjF,QAAQ;QACJ,MAAM;QACN,MAAM;YACF;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACH;QACD,UAAU;QACV,OAAO;IACX;IACA,UAAU;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,OAAO;IAAK;IACrD,aAAa;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAY;SAAO;IAAC;IACxD,SAAS;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,KAAK;IAAC;IACpC,WAAW;QAAE,MAAM;IAAO;IAC1B,WAAW;QAAE,MAAM;IAAO;IAC1B,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;QAAE,OAAO;IAAK;AAC5D,GACA;IAAE,YAAY;QAAE,WAAW;QAAM,WAAW;IAAM;AAAE,EAAE,iBAAiB;;uCAG5D,mHAAM,CAAC,QAAQ,IAAI,IAAA,kHAAK,EAAY,YAAY"}},
    {"offset": {"line": 269, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/app/api/gov/verify/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport dbConnect from '@/lib/dbConnect';\r\nimport Document from '@/models/Document';\r\nimport AuditLog from '@/models/AuditLog';\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        await dbConnect();\r\n\r\n        const verifierId = req.headers.get('x-user-id');\r\n        const userRole = req.headers.get('x-user-role');\r\n\r\n        if (userRole !== 'gov') {\r\n            return NextResponse.json({ error: 'Forbidden' }, { status: 403 });\r\n        }\r\n\r\n        const { documentId, decision, reason } = await req.json();\r\n        // decision: 'APPROVE' | 'REJECT'\r\n\r\n        if (!documentId || !decision) {\r\n            return NextResponse.json({ error: 'Missing fields' }, { status: 400 });\r\n        }\r\n\r\n        const doc = await Document.findById(documentId);\r\n        if (!doc) {\r\n            return NextResponse.json({ error: 'Document not found' }, { status: 404 });\r\n        }\r\n\r\n        if (doc.status !== 'PENDING_VERIFICATION') {\r\n            return NextResponse.json({ error: 'Document is not pending verification' }, { status: 400 });\r\n        }\r\n\r\n        if (decision === 'APPROVE') {\r\n            doc.status = 'VERIFIED';\r\n            doc.govAudit.verifiedBy = verifierId;\r\n            doc.govAudit.verifiedAt = new Date();\r\n            await doc.save();\r\n        } else if (decision === 'REJECT') {\r\n            if (!reason) {\r\n                return NextResponse.json({ error: 'Rejection reason is mandatory' }, { status: 400 });\r\n            }\r\n\r\n            // Delete the document as requested\r\n            await Document.findByIdAndDelete(documentId);\r\n\r\n            // Log the deletion (Metadata preserved in audit log)\r\n            await AuditLog.create({\r\n                actorId: verifierId,\r\n                action: 'DOCUMENT_DELETED_REJECTED', // Distinct action\r\n                targetId: documentId, // ID might not point to existing doc anymore, but preserved for history\r\n                targetModel: 'Document',\r\n                details: { decision, reason, originalTitle: doc.title, originalType: doc.type }\r\n            });\r\n\r\n            return NextResponse.json({ success: true, message: \"Document rejected and deleted from vault\" });\r\n        } else {\r\n            return NextResponse.json({ error: 'Invalid decision' }, { status: 400 });\r\n        }\r\n\r\n        // Audit Log\r\n        await AuditLog.create({\r\n            actorId: verifierId,\r\n            action: decision === 'APPROVE' ? 'DOCUMENT_VERIFIED' : 'DOCUMENT_REJECTED',\r\n            targetId: doc._id,\r\n            targetModel: 'Document',\r\n            details: { decision, reason }\r\n        });\r\n\r\n        return NextResponse.json({ success: true, document: doc });\r\n\r\n    } catch (error) {\r\n        console.error(\"Gov Verify Error:\", error);\r\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,IAAA,6HAAS;QAEf,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,MAAM,WAAW,IAAI,OAAO,CAAC,GAAG,CAAC;QAEjC,IAAI,aAAa,OAAO;YACpB,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,MAAM,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QACvD,iCAAiC;QAEjC,IAAI,CAAC,cAAc,CAAC,UAAU;YAC1B,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,MAAM,MAAM,MAAM,+HAAQ,CAAC,QAAQ,CAAC;QACpC,IAAI,CAAC,KAAK;YACN,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqB,GAAG;gBAAE,QAAQ;YAAI;QAC5E;QAEA,IAAI,IAAI,MAAM,KAAK,wBAAwB;YACvC,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAuC,GAAG;gBAAE,QAAQ;YAAI;QAC9F;QAEA,IAAI,aAAa,WAAW;YACxB,IAAI,MAAM,GAAG;YACb,IAAI,QAAQ,CAAC,UAAU,GAAG;YAC1B,IAAI,QAAQ,CAAC,UAAU,GAAG,IAAI;YAC9B,MAAM,IAAI,IAAI;QAClB,OAAO,IAAI,aAAa,UAAU;YAC9B,IAAI,CAAC,QAAQ;gBACT,OAAO,+QAAY,CAAC,IAAI,CAAC;oBAAE,OAAO;gBAAgC,GAAG;oBAAE,QAAQ;gBAAI;YACvF;YAEA,mCAAmC;YACnC,MAAM,+HAAQ,CAAC,iBAAiB,CAAC;YAEjC,qDAAqD;YACrD,MAAM,+HAAQ,CAAC,MAAM,CAAC;gBAClB,SAAS;gBACT,QAAQ;gBACR,UAAU;gBACV,aAAa;gBACb,SAAS;oBAAE;oBAAU;oBAAQ,eAAe,IAAI,KAAK;oBAAE,cAAc,IAAI,IAAI;gBAAC;YAClF;YAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAM,SAAS;YAA2C;QAClG,OAAO;YACH,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,YAAY;QACZ,MAAM,+HAAQ,CAAC,MAAM,CAAC;YAClB,SAAS;YACT,QAAQ,aAAa,YAAY,sBAAsB;YACvD,UAAU,IAAI,GAAG;YACjB,aAAa;YACb,SAAS;gBAAE;gBAAU;YAAO;QAChC;QAEA,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,UAAU;QAAI;IAE5D,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}