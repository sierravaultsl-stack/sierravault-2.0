{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/lib/dbConnect.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI!;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\r\n    \"Please define the MONGODB_URI environment variable inside .env.local\"\r\n  );\r\n}\r\n\r\ninterface MongooseCache {\r\n  conn: typeof mongoose | null;\r\n  promise: Promise<typeof mongoose> | null;\r\n}\r\n\r\ndeclare global {\r\n  var mongoose: MongooseCache | undefined;\r\n}\r\n\r\nlet cached: MongooseCache = global.mongoose || { conn: null, promise: null };\r\n\r\nif (!global.mongoose) {\r\n  global.mongoose = cached;\r\n}\r\n\r\nasync function dbConnect(): Promise<typeof mongoose> {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAWA,IAAI,SAAwB,OAAO,QAAQ,IAAI;IAAE,MAAM;IAAM,SAAS;AAAK;AAE3E,IAAI,CAAC,OAAO,QAAQ,EAAE;IACpB,OAAO,QAAQ,GAAG;AACpB;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,OAAO,OAAO,GAAG,oHAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\nexport interface IUser extends Document {\r\n    email: string;\r\n    password: string;\r\n    telephone: string;\r\n    nin?: string;\r\n    vaultId: mongoose.Types.ObjectId;\r\n    resetToken?: string;\r\n    resetTokenExpiry?: Date;\r\n    // Government Hierarchy\r\n    role: \"citizen\" | \"gov_admin\" | \"gov_official\" | \"gov_associate\";\r\n    organizationId?: mongoose.Types.ObjectId;\r\n    permissions?: string[];\r\n    isActive: boolean;\r\n}\r\n\r\nconst UserSchema = new Schema<IUser>(\r\n    {\r\n        email: { type: String, required: true, unique: true },\r\n        password: { type: String, required: true },\r\n        telephone: { type: String, required: true },\r\n        nin: { type: String, required: false, unique: true, sparse: true },\r\n        vaultId: { type: Schema.Types.ObjectId, ref: \"Vault\", required: true },\r\n        resetToken: { type: String, required: false },\r\n        resetTokenExpiry: { type: Date, required: false },\r\n\r\n        // RBAC Fields\r\n        role: {\r\n            type: String,\r\n            enum: [\"citizen\", \"gov_admin\", \"gov_official\", \"gov_associate\"],\r\n            default: \"citizen\",\r\n            index: true\r\n        },\r\n        organizationId: { type: Schema.Types.ObjectId, ref: \"Organization\" },\r\n        permissions: [{ type: String }], // Granular generic permissions e.g. [\"verify.education\", \"issue.birth_cert\"]\r\n        isActive: { type: Boolean, default: true },\r\n    },\r\n    { timestamps: true }\r\n);\r\n\r\nconst User = mongoose.models.User || mongoose.model<IUser>(\"User\", UserSchema);\r\n\r\nexport default User;\r\n"],"names":[],"mappings":";;;;AAAA;;AAiBA,MAAM,aAAa,IAAI,mHAAM,CACzB;IACI,OAAO;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACpD,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,KAAK;QAAE,MAAM;QAAQ,UAAU;QAAO,QAAQ;QAAM,QAAQ;IAAK;IACjE,SAAS;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAS,UAAU;IAAK;IACrE,YAAY;QAAE,MAAM;QAAQ,UAAU;IAAM;IAC5C,kBAAkB;QAAE,MAAM;QAAM,UAAU;IAAM;IAEhD,cAAc;IACd,MAAM;QACF,MAAM;QACN,MAAM;YAAC;YAAW;YAAa;YAAgB;SAAgB;QAC/D,SAAS;QACT,OAAO;IACX;IACA,gBAAgB;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;IAAe;IACnE,aAAa;QAAC;YAAE,MAAM;QAAO;KAAE;IAC/B,UAAU;QAAE,MAAM;QAAS,SAAS;IAAK;AAC7C,GACA;IAAE,YAAY;AAAK;AAGvB,MAAM,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAQ,QAAQ;uCAEpD"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/models/Organization.ts"],"sourcesContent":["import mongoose, { Schema, Document, model, models } from \"mongoose\";\r\n\r\nexport interface IOrganization extends Document {\r\n    name: string;\r\n    type: \"ministry\" | \"agency\" | \"institution\";\r\n    code: string; // e.g., \"MOE\" for Ministry of Education\r\n    tier: 1 | 2 | 3;\r\n    tags: string[]; // Routing tags, e.g., [\"education\", \"academic\"]\r\n    description?: string;\r\n    website?: string;\r\n    logoUrl?: string;\r\n    createdAt: Date;\r\n    updatedAt: Date;\r\n}\r\n\r\nconst OrganizationSchema = new Schema<IOrganization>(\r\n    {\r\n        name: { type: String, required: true, unique: true },\r\n        type: {\r\n            type: String,\r\n            enum: [\"ministry\", \"agency\", \"institution\"],\r\n            required: true\r\n        },\r\n        code: { type: String, required: true, unique: true, uppercase: true },\r\n        tier: { type: Number, enum: [1, 2, 3], required: true },\r\n        tags: [{ type: String }], // Used for smart routing\r\n        description: { type: String },\r\n        website: { type: String },\r\n        logoUrl: { type: String },\r\n    },\r\n    { timestamps: true }\r\n);\r\n\r\n// Prevent duplicate model compilation\r\nexport default models.Organization || model<IOrganization>(\"Organization\", OrganizationSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAeA,MAAM,qBAAqB,IAAI,mHAAM,CACjC;IACI,MAAM;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;IAAK;IACnD,MAAM;QACF,MAAM;QACN,MAAM;YAAC;YAAY;YAAU;SAAc;QAC3C,UAAU;IACd;IACA,MAAM;QAAE,MAAM;QAAQ,UAAU;QAAM,QAAQ;QAAM,WAAW;IAAK;IACpE,MAAM;QAAE,MAAM;QAAQ,MAAM;YAAC;YAAG;YAAG;SAAE;QAAE,UAAU;IAAK;IACtD,MAAM;QAAC;YAAE,MAAM;QAAO;KAAE;IACxB,aAAa;QAAE,MAAM;IAAO;IAC5B,SAAS;QAAE,MAAM;IAAO;IACxB,SAAS;QAAE,MAAM;IAAO;AAC5B,GACA;IAAE,YAAY;AAAK;uCAIR,mHAAM,CAAC,YAAY,IAAI,IAAA,kHAAK,EAAgB,gBAAgB"}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/models/Vault.ts"],"sourcesContent":["import mongoose, { Schema, Document, model, models } from \"mongoose\";\r\n\r\nexport interface IVaultDocument {\r\n    _id: mongoose.Types.ObjectId;\r\n    label: string;\r\n    url: string;\r\n    type: string;\r\n    uploadedAt: Date;\r\n    blockchainHash?: string;\r\n    // Government Fields\r\n    uploadedBy?: mongoose.Types.ObjectId; // User ID of Uploader (Tier 2/3)\r\n    organizationId?: mongoose.Types.ObjectId; // Organization that issued it\r\n    verifiedBy?: mongoose.Types.ObjectId; // User ID of Verifier (Tier 2)\r\n    verifiedAt?: Date;\r\n    status: \"pending\" | \"verified\" | \"rejected\";\r\n    rejectionReason?: string;\r\n    tags?: string[]; // For smart routing (e.g. [\"education\"])\r\n}\r\n\r\nexport interface IVault extends Document {\r\n    userId?: mongoose.Types.ObjectId;\r\n    documents: IVaultDocument[];\r\n}\r\n\r\nconst DocumentSchema = new Schema<IVaultDocument>(\r\n    {\r\n        label: { type: String, required: true },\r\n        url: { type: String, required: true },\r\n        type: { type: String, required: true }, // Mimetype or Doc Type\r\n        uploadedAt: { type: Date, default: Date.now },\r\n        blockchainHash: { type: String },\r\n\r\n        // Government Workflow\r\n        uploadedBy: { type: Schema.Types.ObjectId, ref: \"User\" },\r\n        organizationId: { type: Schema.Types.ObjectId, ref: \"Organization\" },\r\n        verifiedBy: { type: Schema.Types.ObjectId, ref: \"User\" },\r\n        verifiedAt: { type: Date },\r\n        status: {\r\n            type: String,\r\n            enum: [\"pending\", \"verified\", \"rejected\"],\r\n            default: \"verified\" // Default verified for legacy/self-uploaded docs? Or \"pending\"? keeping verified for backward compat for now, but user docs should be auto-verified if self-uploaded? No, self-uploaded are \"personal\". Gov docs are \"pending\" -> \"verified\".\r\n            // Let's set default to \"verified\" for now so existing docs don't break, but new gov flow will control this explicitly.\r\n        },\r\n        rejectionReason: { type: String },\r\n        tags: [{ type: String }],\r\n    },\r\n    { _id: true }\r\n);\r\n\r\nconst VaultSchema = new Schema<IVault>(\r\n    {\r\n        userId: { type: Schema.Types.ObjectId, ref: \"User\", required: false, index: true },\r\n        documents: [DocumentSchema],\r\n    },\r\n    { timestamps: true }\r\n);\r\n\r\nexport default models.Vault || model<IVault>(\"Vault\", VaultSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAwBA,MAAM,iBAAiB,IAAI,mHAAM,CAC7B;IACI,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;IACtC,KAAK;QAAE,MAAM;QAAQ,UAAU;IAAK;IACpC,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,YAAY;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;IAC5C,gBAAgB;QAAE,MAAM;IAAO;IAE/B,sBAAsB;IACtB,YAAY;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;IAAO;IACvD,gBAAgB;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;IAAe;IACnE,YAAY;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;IAAO;IACvD,YAAY;QAAE,MAAM;IAAK;IACzB,QAAQ;QACJ,MAAM;QACN,MAAM;YAAC;YAAW;YAAY;SAAW;QACzC,SAAS,WAAW,8OAA8O;IAEtQ;IACA,iBAAiB;QAAE,MAAM;IAAO;IAChC,MAAM;QAAC;YAAE,MAAM;QAAO;KAAE;AAC5B,GACA;IAAE,KAAK;AAAK;AAGhB,MAAM,cAAc,IAAI,mHAAM,CAC1B;IACI,QAAQ;QAAE,MAAM,mHAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;QAAO,OAAO;IAAK;IACjF,WAAW;QAAC;KAAe;AAC/B,GACA;IAAE,YAAY;AAAK;uCAGR,mHAAM,CAAC,KAAK,IAAI,IAAA,kHAAK,EAAS,SAAS"}},
    {"offset": {"line": 311, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/A10%20Projects/SierraVaultMain/app/api/admin/seed/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport dbConnect from \"@/lib/dbConnect\";\r\nimport User from \"@/models/User\";\r\nimport Organization from \"@/models/Organization\";\r\nimport Vault from \"@/models/Vault\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\n// WARNING: This route is for demo initialization only. In production, protect or remove.\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        await dbConnect();\r\n\r\n        // 1. Create Ministries (Tier 2)\r\n        const ministryEd = await Organization.findOneAndUpdate(\r\n            { code: \"MOE\" },\r\n            {\r\n                name: \"Ministry of Education\",\r\n                type: \"ministry\",\r\n                code: \"MOE\",\r\n                tier: 2,\r\n                tags: [\"education\", \"academic\"],\r\n                description: \"Governing body for education and academic certifications.\"\r\n            },\r\n            { upsert: true, new: true }\r\n        );\r\n\r\n        const ministryHealth = await Organization.findOneAndUpdate(\r\n            { code: \"MOHS\" },\r\n            {\r\n                name: \"Ministry of Health & Sanitation\",\r\n                type: \"ministry\",\r\n                code: \"MOHS\",\r\n                tier: 2,\r\n                tags: [\"health\", \"medical\"],\r\n                description: \"Governing body for health certifications and records.\"\r\n            },\r\n            { upsert: true, new: true }\r\n        );\r\n\r\n        // 2. Create Institutions (Tier 3)\r\n        const uniSierra = await Organization.findOneAndUpdate(\r\n            { code: \"USL\" },\r\n            {\r\n                name: \"University of Sierra Leone\",\r\n                type: \"institution\",\r\n                code: \"USL\",\r\n                tier: 3,\r\n                tags: [\"education\"],\r\n                description: \"Public university system.\"\r\n            },\r\n            { upsert: true, new: true }\r\n        );\r\n\r\n        // 3. Create Users\r\n        const salt = await bcrypt.genSalt(10);\r\n        const hashedPwd = await bcrypt.hash(\"password123\", salt); // Default password\r\n\r\n        // Admin User (Tier 1)\r\n        const adminVault = await Vault.create({ documents: [] });\r\n        await User.findOneAndUpdate(\r\n            { email: \"admin@gov.sl\" },\r\n            {\r\n                email: \"admin@gov.sl\",\r\n                password: hashedPwd,\r\n                telephone: \"+23200000000\",\r\n                role: \"gov_admin\",\r\n                permissions: [\"all\"],\r\n                vaultId: adminVault._id\r\n            },\r\n            { upsert: true }\r\n        );\r\n\r\n        // Ministry Official (Tier 2 - Education)\r\n        const moeVault = await Vault.create({ documents: [] });\r\n        await User.findOneAndUpdate(\r\n            { email: \"official@moe.gov.sl\" },\r\n            {\r\n                email: \"official@moe.gov.sl\",\r\n                password: hashedPwd,\r\n                telephone: \"+23200000001\",\r\n                role: \"gov_official\",\r\n                organizationId: ministryEd._id,\r\n                permissions: [\"verify.education\", \"issue.education\"],\r\n                vaultId: moeVault._id\r\n            },\r\n            { upsert: true }\r\n        );\r\n\r\n        // University Associate (Tier 3 - USL)\r\n        const uslVault = await Vault.create({ documents: [] });\r\n        await User.findOneAndUpdate(\r\n            { email: \"registrar@usl.edu.sl\" },\r\n            {\r\n                email: \"registrar@usl.edu.sl\",\r\n                password: hashedPwd,\r\n                telephone: \"+23200000002\",\r\n                role: \"gov_associate\",\r\n                organizationId: uniSierra._id,\r\n                permissions: [\"upload.education\"],\r\n                vaultId: uslVault._id\r\n            },\r\n            { upsert: true }\r\n        );\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            message: \"Government structure seeded successfully.\",\r\n            credentials: {\r\n                admin: \"admin@gov.sl / password123\",\r\n                official: \"official@moe.gov.sl / password123\",\r\n                associate: \"registrar@usl.edu.sl / password123\"\r\n            }\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Seeding failed:\", error);\r\n        return NextResponse.json({ success: false, error: error.message }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAGO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,IAAA,6HAAS;QAEf,gCAAgC;QAChC,MAAM,aAAa,MAAM,mIAAY,CAAC,gBAAgB,CAClD;YAAE,MAAM;QAAM,GACd;YACI,MAAM;YACN,MAAM;YACN,MAAM;YACN,MAAM;YACN,MAAM;gBAAC;gBAAa;aAAW;YAC/B,aAAa;QACjB,GACA;YAAE,QAAQ;YAAM,KAAK;QAAK;QAG9B,MAAM,iBAAiB,MAAM,mIAAY,CAAC,gBAAgB,CACtD;YAAE,MAAM;QAAO,GACf;YACI,MAAM;YACN,MAAM;YACN,MAAM;YACN,MAAM;YACN,MAAM;gBAAC;gBAAU;aAAU;YAC3B,aAAa;QACjB,GACA;YAAE,QAAQ;YAAM,KAAK;QAAK;QAG9B,kCAAkC;QAClC,MAAM,YAAY,MAAM,mIAAY,CAAC,gBAAgB,CACjD;YAAE,MAAM;QAAM,GACd;YACI,MAAM;YACN,MAAM;YACN,MAAM;YACN,MAAM;YACN,MAAM;gBAAC;aAAY;YACnB,aAAa;QACjB,GACA;YAAE,QAAQ;YAAM,KAAK;QAAK;QAG9B,kBAAkB;QAClB,MAAM,OAAO,MAAM,mMAAM,CAAC,OAAO,CAAC;QAClC,MAAM,YAAY,MAAM,mMAAM,CAAC,IAAI,CAAC,eAAe,OAAO,mBAAmB;QAE7E,sBAAsB;QACtB,MAAM,aAAa,MAAM,4HAAK,CAAC,MAAM,CAAC;YAAE,WAAW,EAAE;QAAC;QACtD,MAAM,2HAAI,CAAC,gBAAgB,CACvB;YAAE,OAAO;QAAe,GACxB;YACI,OAAO;YACP,UAAU;YACV,WAAW;YACX,MAAM;YACN,aAAa;gBAAC;aAAM;YACpB,SAAS,WAAW,GAAG;QAC3B,GACA;YAAE,QAAQ;QAAK;QAGnB,yCAAyC;QACzC,MAAM,WAAW,MAAM,4HAAK,CAAC,MAAM,CAAC;YAAE,WAAW,EAAE;QAAC;QACpD,MAAM,2HAAI,CAAC,gBAAgB,CACvB;YAAE,OAAO;QAAsB,GAC/B;YACI,OAAO;YACP,UAAU;YACV,WAAW;YACX,MAAM;YACN,gBAAgB,WAAW,GAAG;YAC9B,aAAa;gBAAC;gBAAoB;aAAkB;YACpD,SAAS,SAAS,GAAG;QACzB,GACA;YAAE,QAAQ;QAAK;QAGnB,sCAAsC;QACtC,MAAM,WAAW,MAAM,4HAAK,CAAC,MAAM,CAAC;YAAE,WAAW,EAAE;QAAC;QACpD,MAAM,2HAAI,CAAC,gBAAgB,CACvB;YAAE,OAAO;QAAuB,GAChC;YACI,OAAO;YACP,UAAU;YACV,WAAW;YACX,MAAM;YACN,gBAAgB,UAAU,GAAG;YAC7B,aAAa;gBAAC;aAAmB;YACjC,SAAS,SAAS,GAAG;QACzB,GACA;YAAE,QAAQ;QAAK;QAGnB,OAAO,+QAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,SAAS;YACT,aAAa;gBACT,OAAO;gBACP,UAAU;gBACV,WAAW;YACf;QACJ;IAEJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrF;AACJ"}}]
}